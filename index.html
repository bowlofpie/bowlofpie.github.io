
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Exercise - Running Ad-hoc commands | lightbulb</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Exercise - Running Ad-hoc commands" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Ansible Lightbulb project is an effort to provide a content toolkit and educational reference for effectively communicating and teaching Ansible topics." />
<meta property="og:description" content="The Ansible Lightbulb project is an effort to provide a content toolkit and educational reference for effectively communicating and teaching Ansible topics." />
<link rel="canonical" href="http://ansible.github.io/lightbulb/guides/ansible_engine/1-adhoc/" />
<meta property="og:url" content="http://ansible.github.io/lightbulb/guides/ansible_engine/1-adhoc/" />
<meta property="og:site_name" content="lightbulb" />
<script type="application/ld+json">
{"description":"The Ansible Lightbulb project is an effort to provide a content toolkit and educational reference for effectively communicating and teaching Ansible topics.","@type":"WebPage","url":"http://ansible.github.io/lightbulb/guides/ansible_engine/1-adhoc/","headline":"Exercise - Running Ad-hoc commands","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    <meta name="robots" content="noindex">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href="https://fonts.googleapis.com/css?family=Overpass:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="/lightbulb/assets/css/bootstrap-4-grid-utils.min.css?v=7e4d43d2dab9cf2c42814f0e1b66c9aec39a0517">
    <link rel="stylesheet" href="/lightbulb/assets/css/style.css?v=7e4d43d2dab9cf2c42814f0e1b66c9aec39a0517">
    <link rel="stylesheet" href="/lightbulb/assets/css/ansible.css?v=7e4d43d2dab9cf2c42814f0e1b66c9aec39a0517">
  </head>
  <body>
    <section class="page-header">
      <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">
              <h1 class="project-name">Red Hat Ansible Automation <br/><strong class="text-nowrap">Technical Workshops</strong></h1>
              <h2>The Ansible Lightbulb project is an effort to provide a content toolkit and educational reference for effectively communicating and teaching Ansible topics.</h2>
              
                <a href="https://github.com/ansible/lightbulb" class="btn btn-ghost">View on GitHub</a>
              
            </div>
        </div>
      </div>
    </section>

    <section class="main-content">
      <h1 id="exercise---running-ad-hoc-commands">Exercise - Running Ad-hoc commands</h1>

<p>For our first exercise, we are going to run some ad-hoc commands to help you get a feel for how Ansible works.  Ansible Ad-Hoc commands enable you to perform tasks on remote nodes without having to write a playbook.  They are very useful when you simply need to do one or two things quickly and often, to many remote nodes.</p>

<h2 id="section-1-definition-of-the-inventory">Section 1: Definition of the inventory</h2>

<p>Inventories are crucial to Ansible as they define remote machines on which you wish to run commands or your playbook(s). In this lab the inventory is provided by your instructor. The inventory is an ini formatted file listing your hosts, sorted in groups, additionally providing some variables. It looks like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>all:vars]
<span class="nv">ansible_user</span><span class="o">=</span>rwolters
<span class="nv">ansible_ssh_pass</span><span class="o">=</span>averysecretpassword
<span class="nv">ansible_port</span><span class="o">=</span>22

<span class="o">[</span>web]
node-ansible_host<span class="o">=</span>.22.33.44
node-2 <span class="nv">ansible_host</span><span class="o">=</span>22.33.44.55
node-3 <span class="nv">ansible_host</span><span class="o">=</span>33.44.55.66

<span class="o">[</span>control]
ansible <span class="nv">ansible_host</span><span class="o">=</span>44.55.66.77
</code></pre></div></div>

<p>Your individual inventory is already present in your lab environment underneath <code class="highlighter-rouge">lightbulb/lessons/lab_inventory/$USERNAME-instances.txt</code>, where <code class="highlighter-rouge">$USERNAME</code> is replaced by your individual username.</p>

<h2 id="section-2-basic-ansible-configuration">Section 2: Basic Ansible configuration</h2>

<p>Ansible needs to know which inventory file should be used. By default it checks for the inventory file at <code class="highlighter-rouge">/etc/ansible/hosts</code>. You need to point Ansible to your own, lab specific inventory file. One way to do this is to specify the path to the inventory file with the <code class="highlighter-rouge">-i</code> option to the ansible command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible <span class="nt">-i</span> hosts ...
</code></pre></div></div>

<p>To avoid the need to specify the inventory file each time, the inventory can also be configured in the configuration file <code class="highlighter-rouge">.ansible.cfg</code>. If this file is present, Ansible will read configuration parameters like the inventory location and others from this file.</p>

<p>On your control node, such a file is already present right in the home directory of your user. It is already customized to point to your inventory file, so there is nothing further you have to do.</p>

<h2 id="section-3-ping-a-host">Section 3: Ping a host</h2>

<p>Let’s start with something basic and use the <code class="highlighter-rouge">ping</code> module to test that Ansible has been installed and configured correctly and all hosts in your inventory are responsive.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible all <span class="nt">-m</span> ping
</code></pre></div></div>

<h2 id="section-4-run-a-typical-command">Section 4: Run a typical command</h2>

<p>Now let’s see how we can run a typical Linux shell command and format the output using the <code class="highlighter-rouge">command</code> module.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible web <span class="nt">-m</span> <span class="nb">command</span> <span class="nt">-a</span> <span class="s2">"uptime"</span> <span class="nt">-o</span>
</code></pre></div></div>

<h2 id="section-5-gather-facts-about-target-node">Section 5: Gather facts about target node</h2>

<p>We can use an ad-hoc command with the <code class="highlighter-rouge">setup</code> module to display the many facts Ansible can discover about each node in its inventory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible all <span class="nt">-m</span> setup
</code></pre></div></div>

<h2 id="section-6-install-package">Section 6: Install package</h2>

<p>Now, let’s install Apache using the <code class="highlighter-rouge">yum</code> module.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible web <span class="nt">-m</span> yum <span class="nt">-a</span> <span class="s2">"name=httpd state=present"</span> <span class="nt">-b</span>
</code></pre></div></div>

<p>Usually, only root users are allowed to install packages. So this is a case where we need privilege escalation and a sudo that has to be setup properly. We need to instruct ansible to use sudo to run the command as root by using the parameter <code class="highlighter-rouge">-b</code> (think “become”).</p>

<h2 id="section-7-start-service">Section 7: Start service</h2>

<p>OK, Apache is installed now so let’s start it up using the <code class="highlighter-rouge">service</code> module.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible web <span class="nt">-m</span> service <span class="nt">-a</span> <span class="s2">"name=httpd state=started"</span> <span class="nt">-b</span>
</code></pre></div></div>

<h2 id="section-8-stop-service">Section 8: Stop service</h2>

<p>Finally, let’s clean up after ourselves.  First, stop the httpd service.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible web <span class="nt">-m</span> service <span class="nt">-a</span> <span class="s2">"name=httpd state=stopped"</span> <span class="nt">-b</span>
</code></pre></div></div>

<h2 id="section-9-remove-package">Section 9: Remove package</h2>

<p>Next, remove the Apache package.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible web <span class="nt">-m</span> yum <span class="nt">-a</span> <span class="s2">"name=httpd state=absent"</span> <span class="nt">-b</span>
</code></pre></div></div>

<hr />
<p><strong>NOTE:</strong> Additional <code class="highlighter-rouge">ansible</code> options</p>

<p>The way <code class="highlighter-rouge">ansible</code> works can be influenced by various options which can be listed via <code class="highlighter-rouge">ansible --help</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible <span class="nt">--help</span>
Usage: ansible &lt;host-pattern&gt; <span class="o">[</span>options]

Define and run a single task <span class="s1">'playbook'</span> against a <span class="nb">set </span>of hosts

Options:
  <span class="nt">-a</span> MODULE_ARGS, <span class="nt">--args</span><span class="o">=</span>MODULE_ARGS
                        module arguments
  <span class="nt">--ask-vault-pass</span>      ask <span class="k">for </span>vault password
  <span class="nt">-B</span> SECONDS, <span class="nt">--background</span><span class="o">=</span>SECONDS
                        run asynchronously, failing after X seconds
                        <span class="o">(</span><span class="nv">default</span><span class="o">=</span>N/A<span class="o">)</span>
  <span class="nt">-C</span>, <span class="nt">--check</span>           don<span class="s1">'t make any changes; instead, try to predict some
                        of the changes that may occur
  -D, --diff            when changing (small) files and templates, show the
                        differences in those files; works great with --check
[...]
</span></code></pre></div></div>

<hr />

<p><a href="/lightbulb/guides/ansible_engine/">Click Here to return to the Ansible Lightbulb - Ansible Engine Guide</a></p>

    </section>

      <footer class="site-footer">
        <div class="container">
          <p>Red Hat, the Shadowman logo, Ansible, and Ansible Tower are trademarks or registered trademarks of Red Hat, Inc. or its subsidiaries in the United States and other countries.</p>
            
          <p>All other parts of Ansible Lightbulb are made available under the terms of the MIT License</p>
        </div>
      </footer>

    
  </body>
</html>
